---
title: "Catta"
author: "Justine Catta"
format: html
---
# link to github :
https://github.com/cattajustine-spec/test-grades.git


# introduction

```{r}
library(vroom)
library(ggplot2)
library(knitr)
library(dplyr)
library(here)
library(readr)
library(knitr)
library(lubridate)
library(tidyr)
```

```{r}
here::i_am("test-grades.Rproj")
```

# 1.1

## question 1

```{r}
courses <- vroom(here("data", "courses.csv"))
```

## question 2

```{r}
courses <- courses |>
  rename(`course name` = course,
    identifier = course_id,
    `number of exams` = nb_grades) |>
  arrange(`course name`) 
 courses |> knitr::kable(format = "markdown")
```

# 1.2

## question 3

```{r}
students <- vroom(here("data", "students.csv"))
spec(students)
```

```{r}
students <- read_csv("data/students.csv", 
    col_types = cols(
     id = col_integer(),
    group = col_factor(),
    sex = col_factor(), 
    birth_date = col_date()))

```

```{r}
cols_to_report <- c("birth_date", "sex")

for (col in cols_to_report) {
  cat("The **", col, "** column of the **students** data frame is of class **",
      class(students[[col]])[1], "**.\n\n", sep = "")}
```

# 1.3
## question 4

```{r}
grades <- vroom(here("data", "grades.csv"))
```
```{r}
grades <- read_delim(
  here("data", "grades.csv"),
  delim = ";",
  na = "*",
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()))
```

# 2
## question 5

```{r}
students |> 
  count(group) |>
  ggplot(aes(x = group, y = n)) +
  geom_bar(stat = "identity") +
  labs(x = "Group",
    y = "Number of Students",
    title = "Number of Students per Group") +
  theme_minimal()
```

## question 6

```{r}
students |>
  count(group, sex) |>
  ggplot(aes(x = group, y = n, fill = sex)) +
  geom_bar(stat = "identity", position = position_fill()) +
  labs(x = "Group",
    y = "Number of Students",
    fill = "Sex",
    title = "Gender Balance per Group") +
  theme_minimal()
```

## question 7

```{r}
students <- students |> 
    mutate(age = round(time_length(today() - birth_date, unit = "year")))
```


```{r}
students |> 
  ggplot(aes(x = age)) +
  geom_histogram(bins = 20) +
  labs(x = "Age",
    y = "Number of Students",
    title = "Distribution of Student Ages") +
  theme_minimal()
```

## question 8

```{r}
median_age_group <- students |> 
  group_by(group) |>
  summarise("Median age" = round(median(age)), .groups = "drop")

median_age_group |> knitr::kable(format = "markdown", caption = "Median Age of Students per Group")
```

## question 9

```{r}
oldest_per_group <- students |>
  group_by(group) |>
  slice_max(age, n = 1, with_ties = FALSE) |>
  ungroup() |>
  select(id, sex, age) |>
  arrange(desc(age))

oldest_per_group |>
  knitr::kable(format = "markdown", caption = "Oldest Student in Each Group")
```
# 3
## question 10

```{r}
num_grades <- grades |>
  filter(!is.na(grade)) |>
  nrow()

cat("The data set contains", num_grades, "grades.")
```
## question 11

```{r}
courses <- courses |>
  rename(
    course = `course name`,
    course_id = identifier
  )

grades_courses <- grades |>
  inner_join(courses |> select(course_id, course),
    by = join_by(course_id)) |> select(id, course, grade) |>
  inner_join(students |> select (id, group), by = join_by(id)) |> 
  select(id, group, course, grade) 
```


```{r}
avg_grades_martial <- grades_courses |>
  filter(course == "Martial Arts and Self-Defense") |>
  group_by(group) |>
  summarise(avg_grade = mean(grade, na.rm = TRUE), .groups = "drop")
```


```{r}
avg_grades_martial |>
  ggplot(aes(x = group, y = avg_grade)) +
  geom_col() +
  labs(x = "Group",
    y = "Average Grade",
    title = "Average Grade in Martial Arts and Self-Defense per Group") +
  theme_minimal()
```

## question 12

```{r}
grades <- grades |>
  inner_join(courses |> select(course_id, trimester), by = join_by(course_id)) |>
  filter (!is.na(grade))

grades |>
  ggplot(aes(x = grade, fill = factor(trimester))) +
  geom_density(alpha = 0.4) +
  labs(
    x = "Grade",
    y = "Density",
    fill = "Trimester",
    title = "Distribution of Grades by Trimester"
  ) +
  theme_minimal()
```

As we can see, the peak of grades in trimester 1 is above the ones of trimester 2 and 3, because it is around 14 when the other two are more around 10 for trimester 2 and 7.5 for trimester 3. It seems like the year gets more difficult as time passes.
Also for the 1st trimester, the grades seem to be more volatile with a huge part of students between 6 and 16, the second trimester shows a small variance but with a long tail to the right.  

# 4

## question 13
```{r}
grades_per_student <- grades |>
  filter(!is.na(grade)) |>
  group_by(id) |>
  summarise(num_grades = n(), .groups = "drop") |>
  inner_join(
    students |> select(id, group, sex),
    by = join_by(id)
  )

grades_per_student |>
  slice_head(n = 5) |>
  knitr::kable(caption = "Number of grades per student (extract)")


summary_table <- grades_per_student |>
  summarise(
    min = min(num_grades),
    max = max(num_grades),
    mean = mean(num_grades),
    median = median(num_grades)
  )

summary_table |>
  knitr::kable(caption = "Summary of number of grades per student", format = "markdown")
```

## question 14

```{r}
grades_per_student |>
  ggplot(aes(x = num_grades, fill = sex)) +
  geom_histogram(binwidth = 0.5, position = "dodge") +
  labs(
    x = "Number of Grades",
    y = "Number of Students",
    fill = "Sex",
    title = "Distribution of Number of Grades by Sex"
  ) +
  theme_minimal()
```

## question 15

```{r}
drumming_grades <- grades |>
  filter(!is.na(grade)) |>
  inner_join(
    courses |> select(course_id, course),
    by = join_by(course_id)
  ) |>
  filter(course == "Drumming and Music") |>
  group_by(id) |>
  summarise(num_grades_drumming = n(), .groups = "drop") |>
  inner_join(
    students |> select(id, group, sex),
    by = join_by(id)
  )

drumming_grades |>
  select (id, group, num_grades_drumming) |>
  rename ("Number of grades in Drumming class" = num_grades_drumming) |>
  slice_head(n = 5) |>
  knitr::kable(caption = "Number of grades in Drumming and Music per student (extract)", format = "markdown")
```
## question 16

```{r}
drumming_distribution <- drumming_grades |>
  group_by(num_grades_drumming) |>
  summarise(num_students = n(), .groups = "drop")

drumming_distribution |>
  ggplot(aes(x = num_grades_drumming, y = num_students)) +
  geom_col() +
  labs(
    x = "Number of Grades in Drumming and Music",
    y = "Number of Students",
    title = "Distribution of Number of Grades in Drumming and Music"
  ) +
  theme_minimal()
```

## question 17

```{r}
avg_grades_group <- drumming_grades |>
  group_by(group) |>
  summarise(avg_num_grades = mean(num_grades_drumming), .groups = "drop")

avg_grades_group |>
  ggplot(aes(x = group, y = avg_num_grades)) +
  geom_col() +
  labs(
    x = "Group",
    y = "Average Number of Grades",
    title = "Average Number of Grades in Drumming per Group"
  ) +
  theme_minimal()
```
As we can see, there is no link between the group and the number of grades in Drumming, per student.

## question 18

```{r}
avg_grades_group_sex <- drumming_grades |>
  group_by(group, sex) |>
  summarise(avg_num_grades = mean(num_grades_drumming), .groups = "drop")


avg_grades_group_sex |>
  ggplot(aes(x = group, y = avg_num_grades, fill = sex)) +
  geom_col(position = "dodge") +
  labs(
    x = "Group",
    y = "Average Number of Grades",
    fill = "Sex",
    title = "Average Number of Grades in Drumming by Group and Sex"
  ) +
  theme_minimal()
```
Fortunately, there seems to be no link between sex, group and grades.


## question 19

```{r}
grades_student_course <- grades_courses |>
  filter(!is.na(grade)) |>
  group_by(id, group, course) |>
  summarise(avg_grade = round(mean(grade),2), .groups = "drop") |>
  pivot_wider(
    id_cols = c(id, group),
    names_from = course,
    values_from = avg_grade
  )

grades_student_course |>
  slice_head(n = 5) |>
  knitr::kable(caption = "Average grades per student")
```

## question 20

```{r}
grades_student_course |>
  ggplot(aes(
    x = `Astronomy and Celestial Navigation`,
    y = `Storytelling and Oral Tradition`
  )) +
  geom_point(color = "steelblue", alpha = 0.7) +
  labs(
    x = "Average Grade in Astronomy and Celestial Navigation",
    y = "Average Grade in Storytelling and Oral Tradition",
    title = "Comparison of Average Grades per Student"
  ) +
  theme_minimal()
```
There is no causality between the average grade in astronomy and the average grade in storytelling. 

## question 21

```{r}
correlation_group <- grades_student_course |>
  group_by(group) |>
  summarise(
    Correlation = cor(
      `Earth Magic and Fertility Rituals`,
      `Herbalism and Traditional Medicine`
    ),
    .groups = "drop"
  )

correlation_group |>
  knitr::kable(caption = "Correlation between Earth Magic and Herbalism by group", fromat = "markdown")
```

## question 22

```{r}
grades_student_course |>
  filter(group == correlation_group |>
           slice_max(abs(Correlation), n = 1) |>
           pull(group)) |>
  ggplot(aes(
    x = `Herbalism and Traditional Medicine`,
    y = `Earth Magic and Fertility Rituals`
  )) +
  geom_point(color = "steelblue", alpha = 0.7) +
  labs(
    x = "Average Grade in Herbalism and Traditional Medicine",
    y = "Average Grade in Earth Magic and Fertility Rituals",
    title = paste("Correlation Scatter Plot for the group with the highest absolute Correlation")
  ) +
  theme_minimal()
```

## question 23

```{r}
final_grade <- grades_student_course |>
  rowwise() |>
  mutate(final_grade = mean(c_across(-c(id, group)), na.rm = TRUE)) |>
  ungroup() |>
  inner_join(
    students |> select(id, sex),
    by = join_by(id)
  ) |>
  select(id, group, sex, final_grade) |>
  arrange(desc(final_grade))

final_grade |>
  slice_head(n = 5) |>
  knitr::kable(caption = "Top 5 Students by Final Grade")
```
## question 24

```{r}
final_grade |>
  ggplot(aes(x = factor(group), y = final_grade)) +
  geom_boxplot(fill = "steelblue", alpha = 0.7) +
  labs(
    x = "Group",
    y = "Final Grade",
    title = "Distribution of Final Grades by Group"
  ) +
  theme_minimal()
```



## question 25


```{r}
final_grade |>
  ggplot(aes(x = factor(group), y = final_grade, fill = sex)) +
  geom_boxplot() +
  labs(
    x = "Group",
    y = "Final Grade",
    fill = "Sex",
    title = "Distribution of Final Grades by Group and Sex"
  ) +
  theme_minimal()
```


## question 26

```{r}
pass_data <- grades_student_course |>
  pivot_longer(cols = -c(id, group), names_to = "course", values_to = "avg_grade") |>
  inner_join(grades |> select(course_id, trimester) |> distinct() |> 
               inner_join(courses |> select(course, course_id), by = join_by(course_id)),
             by = join_by(course)) |>
  group_by(id) |>
  summarise(
    final_grade = mean(avg_grade, na.rm = TRUE), 
    min_course_grade = min(avg_grade, na.rm = TRUE), 
    trimester_avg_ok = all(tapply(avg_grade, trimester, mean) >= 10),
    .groups = "drop"
  ) |>
  mutate(
    pass = min_course_grade >= 5 & trimester_avg_ok
  ) |>
  inner_join(students |> select(id, group, sex), by = join_by(id)) |>
  select(id, group, sex, final_grade, pass)


pass_data |>
  slice_head(n = 5) |>
  knitr::kable(caption = "Pass/Fail Status per Student")
```

## question 27

```{r}
fail_high_grade <- pass_data |>
  filter(!pass & final_grade >= 10)

cat("The number of students who do not pass but have a final grade above 10 is", nrow(fail_high_grade))
```

## question 28

```{r}
pass_rate_group <- pass_data |>
  group_by(group) |>
  summarise(pass_rate = mean(pass), .groups = "drop")

pass_rate_group |>
  ggplot(aes(x = factor(group), y = pass_rate)) +
  geom_col() +
  labs(
    x = "Group",
    y = "Pass Rate"
  ) +
  theme_minimal()

```
The pass rate is very low, for each group. For only 7 groups, some students passed.

















