---
title: "Catta"
author: "Justine Catta"
format: html
---
# link to github :
https://github.com/cattajustine-spec/test-grades.git


# introduction

```{r}
library(vroom)
library(ggplot2)
library(knitr)
library(dplyr)
library(here)
library(readr)
library(knitr)
library(lubridate)
```

```{r}
here::i_am("test-grades.Rproj")
```

# 1.1

## question 1

```{r}
courses <- vroom(here("data", "courses.csv"))
```

## question 2

```{r}
courses <- courses |>
  rename(`course name` = course,
    identifier = course_id,
    `number of exams` = nb_grades) |>
  arrange(`course name`) 
 courses |> knitr::kable(format = "markdown")
```

# 1.2

## question 3

```{r}
students <- vroom(here("data", "students.csv"))
spec(students)
```

```{r}
students <- read_csv("data/students.csv", 
    col_types = cols(
     id = col_integer(),
    group = col_factor(),
    sex = col_factor(), 
    birth_date = col_date()))

```

```{r}
cols_to_report <- c("birth_date", "sex")

for (col in cols_to_report) {
  cat("The **", col, "** column of the **students** data frame is of class **",
      class(students[[col]])[1], "**.\n\n", sep = "")}
```

# 1.3
## question 4

```{r}
grades <- vroom(here("data", "grades.csv"))
```
```{r}
grades <- read_delim(
  here("data", "grades.csv"),
  delim = ";",
  na = "*",
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()))
```

# 2
## question 5

```{r}
students |> 
  count(group) |>
  ggplot(aes(x = group, y = n)) +
  geom_bar(stat = "identity") +
  labs(x = "Group",
    y = "Number of Students",
    title = "Number of Students per Group") +
  theme_minimal()
```

## question 6

```{r}
students |>
  count(group, sex) |>
  ggplot(aes(x = group, y = n, fill = sex)) +
  geom_bar(stat = "identity", position = position_fill()) +
  labs(x = "Group",
    y = "Number of Students",
    fill = "Sex",
    title = "Gender Balance per Group") +
  theme_minimal()
```

## question 7

```{r}
students <- students |> 
    mutate(age = round(time_length(today() - birth_date, unit = "year")))
```


```{r}
students |> 
  ggplot(aes(x = age)) +
  geom_histogram(bins = 20) +
  labs(x = "Age",
    y = "Number of Students",
    title = "Distribution of Student Ages") +
  theme_minimal()
```

## question 8

```{r}
median_age_group <- students |> 
  group_by(group) |>
  summarise("Median age" = round(median(age)), .groups = "drop")

median_age_group |> knitr::kable(format = "markdown", caption = "Median Age of Students per Group")
```

## question 9

```{r}
oldest_per_group <- students |>
  group_by(group) |>
  slice_max(age, n = 1, with_ties = FALSE) |>
  ungroup() |>
  select(id, sex, age) |>
  arrange(desc(age))

oldest_per_group |>
  knitr::kable(format = "markdown", caption = "Oldest Student in Each Group")
```

## question 10

```{r}
num_grades <- grades |>
  filter(!is.na(grade)) |>
  nrow()

cat("The data set contains", num_grades, "grades.")
```
## question 11

```{r}
courses <- courses |>
  rename(
    course = `course name`,
    course_id = identifier
  )

grades_courses <- grades |>
  inner_join(courses |> select(course_id, course),
    by = join_by(course_id)) |> select(id, course, grade) |>
  inner_join(students |> select (id, group), by = join_by(id)) |> 
  select(id, group, course, grade) 
```


```{r}
avg_grades_martial <- grades_courses |>
  filter(course == "Martial Arts and Self-Defense") |>
  group_by(group) |>
  summarise(avg_grade = mean(grade, na.rm = TRUE), .groups = "drop")
```


```{r}
avg_grades_martial |>
  ggplot(aes(x = group, y = avg_grade)) +
  geom_col() +
  labs(x = "Group",
    y = "Average Grade",
    title = "Average Grade in Martial Arts and Self-Defense per Group") +
  theme_minimal()
```

## question 12

```{r}
grades <- grades |>
  inner_join(courses |> select(course_id, trimester), by = join_by(course_id)) |>
  filter (!is.na(grade))

grades |>
  ggplot(aes(x = grade, fill = factor(trimester))) +
  geom_density(alpha = 0.4) +
  labs(
    x = "Grade",
    y = "Density",
    fill = "Trimester",
    title = "Distribution of Grades by Trimester"
  ) +
  theme_minimal()
```

As we can see, the peak of grades in trimester 1 is above the ones of trimester 2 and 3, because it is around 14 when the other two are more around 10 for trimester 2 and 7.5 for trimester 3. It seems like the year gets more difficult as time passes.
Also for the 1st trimester, the grades seem to be more volatile with a huge part of students between 6 and 16, the second trimester shows a small variance but with a long tail to the right. 

# 4

## question 13















